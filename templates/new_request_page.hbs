<div class="container-divider"></div>
<div class="container">
  <nav class="sub-nav">
    {{breadcrumbs}}
    <div class="search-container">
      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" focusable="false" viewBox="0 0 12 12" class="search-icon" aria-hidden="true">
        <circle cx="4.5" cy="4.5" r="4" fill="none" stroke="currentColor"/>
        <path stroke="currentColor" stroke-linecap="round" d="M11 11L7.5 7.5"/>
      </svg>
      {{search submit=false}}
    </div>
  </nav>

  <h1>
    {{t 'submit_a_request'}}
    <span class="follow-up-hint">
      {{follow_up}}
    </span>
  </h1>

  <div id="main-content" class="form">
    {{request_form wysiwyg=true}}
  </div>
</div>

<script>
// Conditional form prefilling for Marketing ticket form
document.addEventListener('DOMContentLoaded', function() {
  const formId = new URLSearchParams(window.location.search).get('ticket_form_id');
  
  if (formId === '1500001438362') { // Marketing form only
    const urlParams = new URLSearchParams(window.location.search);
    const fieldValue = urlParams.get('prefill_marketing_buyups');
    
    if (fieldValue) {
      // Retry mechanism: Zendesk forms may render asynchronously
      const dropdownSelector = '#request_custom_fields_1500007532382';
      let attempts = 0;
      const maxAttempts = 10;
      const retryInterval = 200; // ms
      
      function setDropdownValue() {
        const dropdown = document.querySelector(dropdownSelector);
        if (dropdown) {
          dropdown.value = fieldValue;
          // Trigger change event to ensure Zendesk recognizes the change
          dropdown.dispatchEvent(new Event('change', { bubbles: true }));
          return true;
        }
        return false;
      }
      
      // Try immediately
      if (!setDropdownValue()) {
        // Retry with interval if field not found
        const retryTimer = setInterval(function() {
          attempts++;
          if (setDropdownValue() || attempts >= maxAttempts) {
            clearInterval(retryTimer);
          }
        }, retryInterval);
      }
    }
  }
});
</script>